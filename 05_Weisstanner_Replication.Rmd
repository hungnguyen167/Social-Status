---
title: "01.2_Macro Data Prep"
output:
  html_document:
    df_print: paged
---

```{r setup}
pacman::p_load("tidyverse", 
               "countrycode",
               "readstata13",
               "lme4",
               "sjPlot")


knitr::opts_chunk$set(message = F, warning = F)
```

## Data

```{r loaddata}
df_macro <- readRDS(here::here("data", "df_macro.RDS"))
df_na <- readRDS(here::here("data", "df_na.RDS"))
df_rep <- readstata13::read.dta13(here::here("weisstanner_replication","REPLICATION DATA","AbsRel_FINAL_REP.dta"))

# select out heuristic vars
df_macro <- df_macro %>%
  select(iso3c, wave, libZ_i, lib_redistZ_i, noconf_govZ_i, cpiZ_i)
#merge
# NA and age selection

df_rep <- df_rep %>%
  subset(!is.na(redist3) & age > 17 & age < 66) %>%
  mutate(iso3c = countrycode(country, "country.name", "iso3c")) %>%
  left_join(df_macro, by = c("iso3c","wave"))

```


## Original Model

Results are identical as those when running the xtreg Stata command using the modified original code

```{r omodel}

m02 <- lmer(redist_dum ~ absgr5_wa*relgr5_wa + hinc_decile + factor(educ_tert) + female + age + factor(unemployed) + factor(wave) + unemp + socexp + gini_mkt + gdppc + (1 | cwave), data = df_rep)
```

## Original Model Stripped

We test removing the country level variables given that we now have only 36 country-wave units. Results for absolute and relative are nearly identical, therefore we proceed with this model for parsimony.

```{r omodel_strip}
m03 <- lmer(redist_dum ~ absgr5_wa*relgr5_wa + hinc_decile + factor(educ_tert) + female + age + factor(unemployed) + factor(wave) + gdppc + (1 | cwave), data = df_rep)
```

## Heuristics Added

### Models
```{r hmodel}
m04_1 <- lmer(redist_dum ~ absgr5_wa*relgr5_wa + hinc_decile + factor(educ_tert) + female + age + factor(unemployed) + factor(wave) + gdppc*libZ_i + (1 | cwave), data = df_rep) 

m04_2 <- lmer(redist_dum ~ absgr5_wa*relgr5_wa + hinc_decile + factor(educ_tert) + female + age + factor(unemployed) + factor(wave) + gdppc*lib_redistZ_i + (1 | cwave), data = df_rep)

m04_3 <- lmer(redist_dum ~ absgr5_wa*relgr5_wa + hinc_decile + factor(educ_tert) + female + age + factor(unemployed) + factor(wave) + gdppc*noconf_govZ_i + (1 | cwave), data = df_rep)

m04_4 <- lmer(redist_dum ~ absgr5_wa*relgr5_wa + hinc_decile + factor(educ_tert) + female + age + factor(unemployed) + factor(wave) + gdppc*cpiZ_i + (1 | cwave), data = df_rep)
```

### Tables
```{r hmodeltab}
tab_model(m04_1, m04_2, m04_3, m04_4, p.style = "stars", show.ci = F)
```

