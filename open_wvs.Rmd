---
title: "WVS"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Open, aggregate and save WVS data


```{r open}
library("data.table")        
library(tidyverse)
wvs <- fread("data/WVS_TimeSeries_1981_2020_ascii_v2_0.csv", select = c("S002VS", "COUNTRY_ALPHA", "S020", "E037", "E069_11", "E119", "E236", "E131", "E112", "E130"))
wvs <- rename(wvs, wave = S002VS, year = S020, liberal = E037, confidence_gov = E069_11, system_rating = E112, freedom_gov = E119, democratic = E236, reason_neediness = E131, poverty_compare = E130)
write.csv(wvs, "data/wvs.csv", row.names = FALSE)
```

Aggregate and save the data

```{r aggregate}
agg <- read_csv(here::here("data","wvs.csv"))
agg <- agg %>%
  group_by(COUNTRY_ALPHA, year, wave) %>%
  summarise_at(.vars = names(.)[-3:-1], .funs = c(mean))
write.csv(agg, "data/wvs_aggregated.csv", row.names = FALSE)

```