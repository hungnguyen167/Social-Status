---
title: "Social Status, Liberalization and Attitudes toward Redistribution"
output:
  html_document:
    df_print: paged
---

"Social Status, Liberalization and Attitudes toward Redistribution"

##### ISSP, Social Inequality, Cumulation (1987, 1992, 1999 & 2009)
##### ISSP, Environment, 1993, 2000 & 2010
$~$
$~$

#### **Nate Breznau, Lisa Heukamp & Hung H.V. Nguyen**
#### **University of Bremen**

_____________________________________________________________________________

$~$
$~$

Working paper available here: https://docs.google.com/document/d/1mST25rKYZ5wChRj5WyhxH_65RUa9MNR2OsO5B4-qcwY/edit#

Github repo: https://github.com/hungnguyen167/Social-Status



```{r, include = F}
rm(list = ls())
```


```{r setup, include=FALSE}
library(pacman)
pacman::p_load("tidyverse","knitr","car","expss","stargazer","lavaan","kableExtra","MASS","glm.predict","brant", "semTools","ggplot2","countrycode")

knitr::opts_chunk$set(message = F, warning = F)

wd <- "C:/data/"

```



## Load Data

The data cleaning is done in the file "Social Status, Liberalization and Attitudes toward Redistribution.Rmd"

```{r}
load(paste0(wd,"socstat.Rda"))
```


# Descriptives

## Table 1. Cases by Country-Wave

```{r tbl1, include = T, echo = T}
# Cross-tab years and countries
options(knitr.kable.NA = '')
tab1 <- df %>%
  dplyr::group_by(country, wave) %>%
  dplyr::summarize(n=n()) %>%
  spread(wave, n) %>%
  kable(., col.names = c("Country", "SI_1987", "SI_1992", "EN_1993", "SI_1999", "EN_2000", "SI_2009", "EN_2010"), caption = "Country Sample Size by Wave, ISSP 'Social Inequality (SI) & Environment (EN)", format.args = list(big.mark = ","))
kable_styling(tab1)
```



## Table 2. Descriptive Statistics

Final coding of variable 'wrkst'
1 Employed, full-time
2 Employed, part-time
3 Employed, less than part-time
5 Unemployed
6 Student, school, vocational training
7 Retired
8 Housewife,-man, home duties or Helping family member
9 Permanently disabled
10 Other, not in labour force, or refused, don't know, no answer


```{r tbl2, echo = T}
tab2 <- dplyr::as.tbl(dplyr::select(df, year, ageC, female, educyrs, degree, child, married, rincZ, hincZ, isei, egp, egp6, union, sparent, wrkhrs, wrkst, reduce))
# make categories out of categorical variables
tab2 <- tab2 %>%
  mutate(egp_un = as.numeric(egp6 == "Unskilled"),
         egp_skl = as.numeric(egp6 == "Skilled"),
         egp_othr = as.numeric(egp6 == "Self"),
         egp_rou = as.numeric(egp6 == "Routine"),
         egp_svc2 = as.numeric(egp6 == "Service II"),
         egp_svc1 = as.numeric(egp6 == "Service I"),
         wk_full = as.numeric(wrkst == 1),
         wk_part = as.numeric(wrkst == 2),
         wk_lesspart = as.numeric(wrkst == 3),
         wk_unemp = as.numeric(wrkst == 5),
         wk_school = as.numeric(wrkst == 6),
         wk_retired = as.numeric(wrkst == 7),
         wk_home = as.numeric(wrkst == 8),
         wk_disab = as.numeric(wrkst == 9),
         wk_other = as.numeric(wrkst == 10))
tab2 <- dplyr::select(tab2, year, ageC, female, educyrs, child, married, rincZ, hincZ, isei, egp_un, egp_skl, egp_othr, egp_rou, egp_svc2, egp_svc1, wk_full:wk_other, wrkhrs, union, sparent, reduce)
# Get summary stats
tab2_1 <- summarise_all(tab2, list(mean), na.rm = T)
tab2_1.1 <- summarise_all(tab2, list(sd), na.rm = T)
tab2_2 <- summarise_all(tab2, list(min), na.rm = T)
tab2_3 <- summarise_all(tab2, list(max), na.rm = T)
tab2_4 <- summarise_all(tab2, funs(sum(!is.na(.))))
# Transpose into columns
tab2_1 <- as.data.frame(t(round(tab2_1, 2)))
tab2_1.1 <- as.data.frame(t(round(tab2_1.1, 2)))
tab2_2 <- as.data.frame(t(round(tab2_2, 0)))
tab2_3 <- as.data.frame(t(round(tab2_3, 0)))
tab2_4 <- as.data.frame(t(tab2_4))
tab2_0 <- as.data.frame(c("Year","Age, in years", "Female", "Education, in years", "Children", "Married", "Indiv. Earnings, country-Z", "Household Earnings, country-Z", "Occ. Status, ISEI", "EGP - Unskilled", "EGP - Skilled", "EGP - Self/Other", "EGP - Routine", "EGP - Service II", "EGP - Service I", "Work - Full-time", "Work - Part-Time", "Work - Less-part-time", "Work - Unemployed", "Work - School/Training", "Work - Retired", "Work - Homecare/Family help", "Work - Disabled", "Work - Other/NA", "Hours Worked", "Union", "Parent", "DV - Support Redistribution"))
# Bind into table
tab2f <- cbind(tab2_0,tab2_1,tab2_1.1,tab2_2,tab2_3,tab2_4)
colnames(tab2f) <- c("Variable","Mean","SD","Min","Max","N")
tab2f <- kable(tab2f)
kable_styling(tab2f)
rm(tab2_0, tab2_1, tab2_1.1, tab2_2, tab2_3, tab2_4)
```

## Fig 1. Scatterplot of Preferences for Redistribution

```{r fig1, echo = T}

# make a label variable
df$lab <- countrycode(df$cntry, "iso3n", "iso2c")
df$lab <- paste0(df$lab,df$year)

fig1 <- df %>%
  group_by(cyear) %>%
  mutate(reduceM = mean(reduce, na.rm = T),
         reduceSE = (sd(reduce, na.rm = T)/sqrt(length(which(!is.na(reduce))))))


fig1 <- dplyr::select(fig1, year, cyear, lab, reduceM, reduceSE, wave, cntry)

fig1 <- aggregate(fig1,  by=list(fig1$lab), FUN=mean, na.rm=T)
colnames(fig1) <- c("lab","year","cyear","skip","reduceM","reduceSE","wave","cntry")

fig1$country <- countrycode(fig1$cntry, "iso3n", "country.name")

# only label countries that are in the survey often)
cntry2 <- as.list(unique(fig1$cntry[fig1$year < 1992]))
fig1$country <- ifelse(fig1$cntry  %in% cntry2, fig1$country, NA)

# drop NA countries
fig1a <- subset(fig1, !is.na(country))
ggplot(fig1a, aes(x=year, y=reduceM, color=country)) + 
    geom_errorbar(aes(ymin=reduceM-reduceSE, ymax=reduceM+reduceSE), colour="grey", width = .15) +
    geom_point(size=2) +
    geom_line() +
    labs(title = "Support for Redistribution Over Time") +
    ylab(label = "Mean Support")

```


## Table 3. Correlations, Pooled

```{r corrs}
tab2 <- dplyr::select(tab2, reduce, everything())
cor1 <- cor(tab2, use = "pairwise.complete.obs")
cor1k <- kable(cor1, digits = 2)
kable_styling(cor1k)
# check that correlations look 'right'
```


## Group Comparisons

Take some basic social groups just for show. (coded above to make easier) 

Group1. Impoverished, Struggling = ISEI < 60, less-part-time or unemp or disabled/sick
Group2. Full-time workers = ISEI < 45, full-time
Group3. High status = ISEI > 72

### Fig 2. Germany

This is problematic. Should be split by East and West Germany

```{r grouptest}
# make a grouping variable 
df <- df %>%
  mutate(groups = ifelse((isei < 60 & wrkst == 3) | (isei < 60 & wrkst == 5) | (isei < 60 & wrkst == 9), 1, ifelse(isei < 45 & wrkst == 1, 2, ifelse(isei > 72, 3, 4))),
         groups = ifelse(is.na(groups), 4, groups))

fig2 <- df %>%
  group_by(cyear, groups) %>%
    mutate(reduceM = mean(reduce, na.rm = T),
           reduceSE = (sd(reduce, na.rm = T)/sqrt(length(which(!is.na(reduce))))))

fig2 <- dplyr::select(fig2, year, cyear, lab, reduceM, reduceSE, wave, cntry, groups)

fig2 <- aggregate(fig2,  by=list(fig2$cyear,fig2$groups), FUN=mean, na.rm=T)

fig2de <- subset(fig2, cntry == 276)
fig2de$groups <- as.factor(fig2de$groups)

ggplot(fig2de, aes(x=year, y=reduceM, color=groups)) + 
    geom_errorbar(aes(ymin=reduceM-reduceSE, ymax=reduceM+reduceSE), colour="grey", width = .15) +
    geom_point(size=2) +
    geom_line() +
    labs(title = "Support for Redistribution Over Time, Germany") +
    ylab(label = "Mean Support") +
    scale_color_hue(labels = c("Marginal", "Blue-collar", "High Status", "other"))

```


### Fig 3. Great Britain

```{r fig3}
fig2gb <- subset(fig2, cntry == 826)
fig2gb$groups <- as.factor(fig2gb$groups)

ggplot(fig2gb, aes(x=year, y=reduceM, color=groups)) + 
    geom_errorbar(aes(ymin=reduceM-reduceSE, ymax=reduceM+reduceSE), colour="grey", width = .15) +
    geom_point(size=2) +
    geom_line() +
    labs(title = "Support for Redistribution Over Time, Great Britain") +
    ylab(label = "Mean Support") +
    scale_color_hue(labels = c("Marginal", "Blue-collar", "High Status", "other"))
```


### Fig 4. United States

This graph indicates there is a problem with our conversion. there are no ISEI scores below 45...

```{r fig4}
fig2us <- subset(fig2, cntry == 840)
fig2us$groups <- as.factor(fig2us$groups)

ggplot(fig2us, aes(x=year, y=reduceM, color=groups)) + 
    geom_errorbar(aes(ymin=reduceM-reduceSE, ymax=reduceM+reduceSE), colour="grey", width = .15) +
    geom_point(size=2) +
    geom_line() +
    labs(title = "Support for Redistribution Over Time, United States") +
    ylab(label = "Mean Support") +
    scale_color_hue(labels = c("Marginal", "Blue-collar", "High Status", "other"))
```